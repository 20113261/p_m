#!/usr/bin/env python
# -*- coding: utf-8 -*-
# @Time    : 2017/12/6 下午9:34
# @Author  : Hou Rong
# @Site    : 
# @File    : select_and_update_table.py
# @Software: PyCharm
from data_source import MysqlSource
from service_platform_conn_pool import poi_ori_pool, poi_face_detect_pool, service_platform_pool
from logger import get_logger

logger = get_logger("select_and_update_table")

poi_ori_config = {
    'host': '10.10.228.253',
    'user': 'mioji_admin',
    'password': 'mioji1109',
    'charset': 'utf8',
    'db': 'ServicePlatform'
}


def update_sql(data):
    sql = '''UPDATE pic_detect_task
SET status = 0
WHERE id in ({});'''.format(
        ','.join(
            map(lambda x: "'{}'".format(x), data)
        )
    )
    conn = service_platform_pool.connection()
    cursor = conn.cursor()
    _res = cursor.execute(sql)
    conn.commit()
    cursor.close()
    conn.close()
    logger.info("[total: {}][execute: {}]".format(len(data), _res))


def get_task():
    sql = '''SELECT id
FROM pic_detect_task
WHERE poi_id IN
      ('qyer###558781','qyer###52728','qyer###54661','qyer###558134','qyer###558215','qyer###558233','qyer###558267','qyer###558285','qyer###558305','qyer###558448','qyer###558491','qyer###558547','qyer###558708','qyer###558745','qyer###558820','qyer###558879','qyer###56415','qyer###52640','qyer###52743','qyer###54680','qyer###558186','qyer###558217','qyer###558241','qyer###558269','qyer###558287','qyer###558309','qyer###558450','qyer###54688','qyer###558193','qyer###558218','qyer###558248','qyer###558272','qyer###558289','qyer###558318','qyer###558452','qyer###558502','qyer###558571','qyer###558717','qyer###558765','qyer###558844','qyer###558915','qyer###57716','qyer###558500','qyer###558565','qyer###558712','qyer###558759','qyer###558841','qyer###558907','qyer###56478','qyer###52736','qyer###54665','qyer###558182','qyer###558216','qyer###558240','qyer###558268','qyer###558286','qyer###558307','qyer###558449','qyer###558493','qyer###54804','qyer###558197','qyer###558223','qyer###558251','qyer###558276','qyer###558291','qyer###558420','qyer###558472','qyer###558506','qyer###558576','qyer###558721','qyer###558770','qyer###558862','qyer###558933','qyer###57721','qyer###54711','qyer###558194','qyer###558222','qyer###558249','qyer###558275','qyer###558290','qyer###558320','qyer###558462','qyer###558504','qyer###558559','qyer###558709','qyer###558750','qyer###558821','qyer###558881','qyer###56421','qyer###558572','qyer###558719','qyer###558768','qyer###558858','qyer###558929','qyer###57719','qyer###558875','qyer###485076','qyer###485000','qyer###118786','qyer###123633','qyer###1329647','qyer###122769','qyer###1414076','qyer###447276','qyer###415327','qyer###86734','qyer###86767','qyer###1207837','qyer###109110','qyer###1207832','qyer###485285','qyer###203099','qyer###105666','qyer###537021','qyer###1451741','qyer###35050','qyer###72483','qyer###82690','qyer###86904','qyer###98539','qyer###69988','qyer###72489','qyer###83266','qyer###87010','qyer###99646','qyer###202648','qyer###69966','qyer###72471','qyer###72491','qyer###84214','qyer###90126','qyer###84188','qyer###88709','qyer###99647','qyer###100230','qyer###106478','qyer###109768','qyer###109849','qyer###109860','qyer###1140829','qyer###116647','qyer###117620','qyer###1209574','qyer###122317','qyer###122455','qyer###123255','qyer###123767','qyer###125028','qyer###1447115','qyer###164229','qyer###102176','qyer###106827','qyer###109840','qyer###109852','qyer###113225','qyer###1163474','qyer###116651','qyer###117851','qyer###1209668','qyer###122337','qyer###122676','qyer###123673','qyer###124124','qyer###1321717','qyer###1454527','qyer###164679','qyer###102167','qyer###106724','qyer###109835','qyer###109850','qyer###111101','qyer###1140830','qyer###116648','qyer###117733','qyer###1209648','qyer###122332','qyer###122456','qyer###123346','qyer###124095','qyer###125610','qyer###1451260','qyer###164231','qyer###102169','qyer###106826','qyer###109838','qyer###109851','qyer###111516','qyer###116030','qyer###116650','qyer###117840','qyer###1209649','qyer###122336','qyer###122675','qyer###123348','qyer###124113','qyer###1321712','qyer###1451997','qyer###164652','qyer###181079','qyer###184915','qyer###202978','qyer###34984','qyer###38773','qyer###39787','qyer###41399','qyer###42506','qyer###42796','qyer###43168','qyer###45192','qyer###46181','qyer###48982','qyer###50242','qyer###51537','qyer###52503','qyer###181078','qyer###184896','qyer###202976','qyer###34964','qyer###38074','qyer###39676','qyer###41387','qyer###42207','qyer###42790','qyer###43147','qyer###45183','qyer###46129','qyer###48966','qyer###50064','qyer###51503','qyer###51876','qyer###181084','qyer###196701','qyer###204467','qyer###35069','qyer###38884','qyer###40533','qyer###41637','qyer###42519','qyer###42804','qyer###43426','qyer###45313','qyer###46272','qyer###49064','qyer###51436','qyer###51613','qyer###52523','qyer###181081','qyer###185944','qyer###203542','qyer###35061','qyer###38843','qyer###40518','qyer###41582','qyer###42509','qyer###42799','qyer###43308','qyer###45307','qyer###46231','qyer###49026','qyer###51186','qyer###51602','qyer###52518','qyer###53417','qyer###538515','qyer###54045','qyer###55213','qyer###55998','qyer###56407','qyer###59328','qyer###61793','qyer###61804','qyer###88358','qyer###94929','qyer###94951','qyer###95014','qyer###53479','qyer###538557','qyer###54172','qyer###55218','qyer###56003','qyer###580621','qyer###59332','qyer###61795','qyer###61806','qyer###88714','qyer###94936','qyer###94952','qyer###95015','qyer###53562','qyer###538719','qyer###54333','qyer###55233','qyer###56029','qyer###581083','qyer###59346','qyer###61798','qyer###61812','qyer###94904','qyer###94940','qyer###94956','qyer###95018','qyer###53538','qyer###538599','qyer###54232','qyer###55230','qyer###56008','qyer###580622','qyer###59339','qyer###61796','qyer###61811','qyer###94855','qyer###94938','qyer###94955','qyer###95017','qyer###123136','qyer###204725','qyer###94916','qyer###123302','qyer###566546','qyer###566263','qyer###568699','qyer###566315','qyer###1448695','qyer###201860','qyer###59125','qyer###73868','qyer###118188','qyer###86694','qyer###57004','qyer###201651','qyer###279997','qyer###428505','qyer###429488','qyer###429764','qyer###430995','qyer###431804','qyer###454679','qyer###459803','qyer###48114','qyer###48754','qyer###501134','qyer###502112','qyer###502038','qyer###545884','qyer###59502','qyer###82246','qyer###82914','qyer###84104','qyer###84342','qyer###84555','qyer###95023','qyer###98561','qyer###99217','qyer###51086','qyer###54023','qyer###545222','qyer###546012','qyer###61971','qyer###82247','qyer###82915','qyer###84105','qyer###84491','qyer###84944','qyer###95029','qyer###98569','qyer###99749','qyer###48453','qyer###501010','qyer###501566','qyer###503610','qyer###53426','qyer###544687','qyer###545800','qyer###581581','qyer###1146305','qyer###429684','qyer###430951','qyer###431567','qyer###454146','qyer###459362','qyer###47942','qyer###48666','qyer###501019','qyer###501568','qyer###50385','qyer###82203','qyer###82908','qyer###84102','qyer###84340','qyer###84539','qyer###84956','qyer###98554','qyer###99207','qyer###53513','qyer###544696','qyer###545861','qyer###59501','qyer###82204','qyer###82909','qyer###84103','qyer###84341','qyer###84553','qyer###86771','qyer###98558','qyer###99208','qyer###430488','qyer###545436','qyer###455435','qyer###546034','qyer###107362','qyer###108831','qyer###111494','qyer###1144714','qyer###1204856','qyer###1205859','qyer###1206848','qyer###1208031','qyer###122414','qyer###123915','qyer###1448381','qyer###1448740','qyer###1449249','qyer###1452521','qyer###105743','qyer###107346','qyer###108830','qyer###109732','qyer###1144125','qyer###119723','qyer###1205857','qyer###1206845','qyer###1208030','qyer###121124','qyer###123496','qyer###1448001','qyer###1448714','qyer###1449231','qyer###1452431','qyer###182976','qyer###204006','qyer###206337','qyer###207792','qyer###39584','qyer###41566','qyer###452383','qyer###452462','qyer###45601','qyer###48602','qyer###513149','qyer###55168','qyer###62009','qyer###66090','qyer###66100','qyer###200638','qyer###204108','qyer###206341','qyer###207793','qyer###40316','qyer###41604','qyer###452393','qyer###452472','qyer###45685','qyer###48612','qyer###513155','qyer###55625','qyer###62143','qyer###66091','qyer###66101','qyer###81521','qyer###81520','qyer###81528','qyer###84928','qyer###89158','qyer###89171','qyer###89373','qyer###94790','qyer###81529','qyer###84929','qyer###89164','qyer###89172','qyer###89374','qyer###94803','qyer###107332','qyer###108821','qyer###108909','qyer###1144121','qyer###119661','qyer###1205785','qyer###120660','qyer###1208029','qyer###1209153','qyer###123487','qyer###1447998','qyer###1448704','qyer###1449207','qyer###1452383','qyer###106682','qyer###108813','qyer###108908','qyer###1139484','qyer###119658','qyer###1205708','qyer###120658','qyer###1208028','qyer###1209127','qyer###123479','qyer###1446211','qyer###1448532','qyer###1449206','qyer###1451992','qyer###164736','qyer###203521','qyer###206336','qyer###207791','qyer###35544','qyer###41485','qyer###452375','qyer###452457','qyer###452493','qyer###48549','qyer###513133','qyer###53688','qyer###61826','qyer###66085','qyer###66099','qyer###81519','qyer###164734','qyer###202749','qyer###206095','qyer###207790','qyer###34616','qyer###41481','qyer###452370','qyer###452450','qyer###452490','qyer###47367','qyer###513130','qyer###513199','qyer###61825','qyer###66084','qyer###66097','qyer###66167','qyer###81527','qyer###84926','qyer###89157','qyer###89170','qyer###89372','qyer###89786','qyer###81526','qyer###84925','qyer###89155','qyer###89169','qyer###89250','qyer###89621','qyer###99414','qyer###103453','qyer###107466','qyer###34482','qyer###1448825','qyer###581276','qyer###84933','qyer###104804','qyer###108004','qyer###1144553','qyer###1149827','qyer###116590','qyer###117174','qyer###117183','qyer###117187','qyer###117191','qyer###117210','qyer###1201726','qyer###1201865','qyer###1207499','qyer###1211088','qyer###1211486','qyer###1211888','qyer###106229','qyer###1101051','qyer###1144554','qyer###1161161','qyer###117170','qyer###117178','qyer###117184','qyer###117188','qyer###117193','qyer###117212','qyer###1201731','qyer###1201871','qyer###1208371','qyer###1211414','qyer###1211636','qyer###1211993','qyer###106231','qyer###112106','qyer###1145607','qyer###1161162','qyer###117171','qyer###117181','qyer###117185','qyer###117189','qyer###117195','qyer###119213','qyer###1201796','qyer###1201874','qyer###1209783','qyer###1211427','qyer###1211662','qyer###1212093','qyer###107358','qyer###1144549','qyer###1145794','qyer###116580','qyer###117173','qyer###117182','qyer###117186','qyer###117190','qyer###117207','qyer###1201604','qyer###1201852','qyer###1205949','qyer###1210091','qyer###1211473','qyer###1211803','qyer###1212095','qyer###1219810','qyer###123549','qyer###124298','qyer###1253756','qyer###1266027','qyer###1452553','qyer###1453565','qyer###14605','qyer###14625','qyer###14631','qyer###164303','qyer###164437','qyer###189225','qyer###201127','qyer###202276','qyer###202901','qyer###121896','qyer###1234685','qyer###1236200','qyer###1252732','qyer###1266011','qyer###1451214','qyer###1452742','qyer###14595','qyer###14615','qyer###14629','qyer###163988','qyer###164432','qyer###189196','qyer###201125','qyer###202272','qyer###202279','qyer###1234660','qyer###1236156','qyer###1251885','qyer###1265056','qyer###1450706','qyer###1452582','qyer###1454918','qyer###14614','qyer###14627','qyer###163986','qyer###164391','qyer###175388','qyer###201124','qyer###202260','qyer###202278','qyer###204859','qyer###122277','qyer###1235915','qyer###124654','qyer###126377','qyer###1446115','qyer###1452560','qyer###1454917','qyer###14608','qyer###14626','qyer###163984','qyer###164390','qyer###165080','qyer###200660','qyer###202254','qyer###202277','qyer###203338','qyer###204861','qyer###33734','qyer###34156','qyer###34535','qyer###36456','qyer###37785','qyer###39251','qyer###43218','qyer###43392','qyer###481770','qyer###481809','qyer###482061','qyer###482319','qyer###482340','qyer###482382','qyer###482846','qyer###204860','qyer###33732','qyer###33751','qyer###34454','qyer###36274','qyer###37349','qyer###39040','qyer###43041','qyer###43390','qyer###45622','qyer###481793','qyer###482040','qyer###482176','qyer###482336','qyer###482380','qyer###482563','qyer###205162','qyer###33750','qyer###34332','qyer###35432','qyer###37236','qyer###38229','qyer###39885','qyer###43257','qyer###45506','qyer###481779','qyer###482019','qyer###482104','qyer###482331','qyer###482376','qyer###482510','qyer###483289','qyer###205161','qyer###33744','qyer###34165','qyer###35231','qyer###36524','qyer###38200','qyer###39356','qyer###43253','qyer###44190','qyer###481776','qyer###481883','qyer###482074','qyer###482324','qyer###482366','qyer###482479','qyer###483256','qyer###483520','qyer###497111','qyer###497405','qyer###497466','qyer###497753','qyer###497855','qyer###498042','qyer###51761','qyer###52428','qyer###52995','qyer###53728','qyer###54096','qyer###54128','qyer###54161','qyer###54636','qyer###54961','qyer###496599','qyer###497117','qyer###497413','qyer###497557','qyer###497805','qyer###497870','qyer###498270','qyer###51805','qyer###52460','qyer###53009','qyer###54069','qyer###54101','qyer###54133','qyer###54169','qyer###54892','qyer###54976','qyer###55066','qyer###55731','qyer###55767','qyer###56545','qyer###56704','qyer###57136','qyer###580659','qyer###59148','qyer###61830','qyer###62225','qyer###73619','qyer###497107','qyer###497197','qyer###497425','qyer###497745','qyer###497837','qyer###497976','qyer###51744','qyer###52401','qyer###52767','qyer###53047','qyer###54093','qyer###54123','qyer###54153','qyer###54223','qyer###54956','qyer###55045','qyer###497101','qyer###497164','qyer###497415','qyer###497728','qyer###497810','qyer###497909','qyer###498273','qyer###52336','qyer###52646','qyer###53038','qyer###54086','qyer###54111','qyer###54138','qyer###54181','qyer###54941','qyer###54999','qyer###55388','qyer###55743','qyer###55797','qyer###56676','qyer###56720','qyer###57347','qyer###59038','qyer###61827','qyer###61831','qyer###62227','qyer###73620','qyer###55714','qyer###55755','qyer###56511','qyer###56688','qyer###57083','qyer###57594','qyer###59055','qyer###61829','qyer###61988','qyer###73458','qyer###99574','qyer###55531','qyer###55750','qyer###55826','qyer###56682','qyer###56725','qyer###57373','qyer###59044','qyer###61828','qyer###61832','qyer###73441','qyer###85387','qyer###115578','qyer###115662','qyer###50170');'''
    data = []
    for line in MysqlSource(poi_ori_config, table_or_query=sql,
                            size=10000, is_table=False,
                            is_dict_cursor=True):
        data.append(line['id'])

    new_data = []
    for line in data:
        new_data.append(line)
        if len(new_data) == 1000:
            update_sql(new_data)
            new_data = []
    update_sql(new_data)


if __name__ == '__main__':
    get_task()
